<!DOCTYPE html>
<html>
   <head>
      <title>JavaScript MQTT WebSocket Example</title>
      <link rel="stylesheet" href="style.css">
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/paho-mqtt/1.0.1/mqttws31.js" type="text/javascript">
	 </script>
	 <script type = "text/javascript" language = "javascript">
		var mqtt;
		var reconnectTimeout = 2000;
		var host="mqtt.dioty.co"; //change this
		var port=8080;

	 	function onConnect() {
	  // Once a connection has been made, make a subscription and send a message.

		console.log("Connected ");
		//mqtt.subscribe("sensor1");
		message = new Paho.MQTT.Message("Phone Connected");
		message.destinationName = "/klovakarlsson@gmail.com/hej";
		mqtt.send(message);
    console.log("Message sent")

    mqtt.subscribe("/klovakarlsson@gmail.com/temp");
    mqtt.subscribe("/klovakarlsson@gmail.com/moist");

	  }

	  function MQTTconnect() {
		console.log("connecting to "+ host +" "+ port);
		mqtt = new Paho.MQTT.Client(host,port,"clientjs");
		//document.write("connecting to "+ host);
		var options = {
			timeout: 3,
			onSuccess: onConnect,
      userName : "klovakarlsson@gmail.com",
	    password : "ee07432c"

		 };

      mqtt.onMessageArrived = function (message) {
        console.log("Message Arrived: " + message.payloadString + " - " + "Topic:     " + message.destinationName);

        if (message.destinationName == "/klovakarlsson@gmail.com/temp"){
          document.getElementById("temp1").innerHTML = message.payloadString + "°C";
          console.log("yayayyaya");
        }else if (message.destinationName == "/klovakarlsson@gmail.com/moist"){
          document.getElementById("temp2").innerHTML = (100 - Math.ceil(message.payloadString / 1023 * 100) + "%");
        }

      }

		mqtt.connect(options); //connect

		}




	  </script>
   </head>
    <body>
      <h1>Smart Garden</h1>
      <div class="container">

      <span class="temp">
        <p id="temp1" style="display: inline;">16°C</p>
      </span>
      <span class="temp">
        <p id="temp2" style="display: inline;">16°C</p>
      </span>



      </div>

    <script>
     MQTTconnect();
    </script>
   </body>
</html>
